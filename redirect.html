<!DOCTYPE html>
<html>
<head>
  <title>Redirecting to Campus Calendar</title>
  <script>
    // Function to get URL parameters
    function getParameterByName(name) {
      const url = window.location.href;
      name = name.replace(/[\[\]]/g, '\\$&');
      const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
          results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    // Main function to handle redirection
    async function redirectToCalendar() {
      try {
        // Get campus location from URL parameter
        const campusLocation = getParameterByName('campus');
        
        // Fetch the JSON mapping file
        const response = await fetch('https://raw.githubusercontent.com/collectivacademyadmin/hubspot-campus-calendars/main/campus-calendars.json');
        const data = await response.json();
        
        // Look up the calendar link for this campus
        let calendarLink = '';
        
        if (campusLocation && data.locations[campusLocation]) {
          calendarLink = data.locations[campusLocation].link;
          // Redirect to the calendar
          window.open(calendarLink, '_blank');
          // Close the iframe
          window.parent.postMessage(JSON.stringify({ "action": "DONE" }), "*");
        } else {
          // Default calendar or error message
          document.body.innerHTML = '<h3>No calendar found for campus: ' + (campusLocation || 'Unknown') + '</h3>';
          return;
        }
      } catch (error) {
        console.error('Error:', error);
        document.body.innerHTML = '<h3>Error loading calendar information: ' + error.message + '</h3>';
      }
    }

    // Run the redirect function when page loads
    window.onload = redirectToCalendar;
  </script>
</head>
<body>
  <h3>Redirecting to campus calendar...</h3>
</body>
</html>
